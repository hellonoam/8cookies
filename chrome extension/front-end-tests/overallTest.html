<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" 
                    "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
	<script src="../js/jquery.js"></script>
	<script src="../js/session.js"></script>
	<script src="../js/tools.js"></script>
	<script src="js/qunit.js"></script>
	<script src="js/qunit.mock.js"></script>
	<link rel="stylesheet" href="css/qunit.css" type="text/css" media="screen" />

	<script>
	var server = "http://localhost";
	$(document).ready(function(){

		test("signup process", 2, function() {
			stop();
			var current = new session();
			current.updateAll();
			chrome.extension.sendRequest({ type: "login",
				username: "user1", password: "pass1", portSession: true},
				function(data) {
					var s = new session();
					s.updateAll();
					deepEqual(s.info, current.info, "logging in with porting" +
						" session leaves all the same");
					var winToOpen = getYahooWin();
					var callback = function() {
						chrome.extension.sendRequest({ type: "logout" }, function() {
							s = new session();
							s.updateAll();
							deepEqual(s.info, current.info, "logging out restores to"
							+ " original state");
							start();
						});
					}
					setWindows([winToOpen], callback, true);
				}
			);
		});

	});

	function getYahooWin() {
		var winToOpen = new Object();
		winToOpen.left = 10;
		winToOpen.top = 10;
		winToOpen.type = "normal";
		winToOpen.height = 400;
		winToOpen.incognito = false;
		winToOpen.width = 400;
		var tab = new Object();
		tab.url = "http://www.yahoo.com";
		tab.selected = false;
		winToOpen.tabs = [tab, tab, tab];
		return winToOpen;
	}
  </script>
</head>
<body>
	<h1 id="qunit-header">Background Tests</h1>
	<h2 id="qunit-banner"></h2>
	<div id="qunit-testrunner-toolbar"></div>
	<h2 id="qunit-userAgent"></h2>
	<ol id="qunit-tests"></ol>
	<div id="qunit-fixture">test markup, will be hidden</div>
</body>
</html>